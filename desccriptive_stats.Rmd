---
title: "descriptive_stats"
author: "Shari Tian"
date: "2/11/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Packages

```{r message = FALSE, warning = FALSE}
library(tidyverse)
library(sf)
```


# Zimbabwe

## Creating final Zimbabwe dataset

```{r}
df1 <- readRDS("DHS_data/Zimbabwe/ZWIR52FL_joined.RDS")
df2 <- readRDS("DHS_data/Zimbabwe/ZWIR62FL_joined.RDS")
df3 <- readRDS("DHS_data/Zimbabwe/ZWIR72FL_joined.RDS")
```

```{r}
zimbabwe <- rbind(df1, df2, df3)
```

```{r}
# filtering for observations within 3 years before to 4 years after conflict
zimbabwe <- zimbabwe %>%
  filter(is.na(time) == FALSE)
```


exposed_reg = 1 if the area the observation is in was exposed to conflict using region as the geographical unit

exposed_10 = 1 if the area the observation is in was exposed to conflict using circles centered at a DHS cluster with a 10 km radius as the geographical unit

exposed_20 = 1 if the area the observation is in was exposed to conflict using circles centered at a DHS cluster with a 20 km radius as the geographical unit

exposed_50 = 1 if the area the observation is in was exposed to conflict using circles centered at a DHS cluster with a 50 km radius as the geographical unit



## Sample size (number of women) by region and cluster

```{r}
zimbabwe %>%
  group_by(v024) %>%#v024 is region, v001 is cluster
  summarise(n = n_distinct(caseid))
```

## Proportion of exposed respondents

```{r}
zimbabwe %>%
  group_by(exposed_reg) %>%
  summarise(n = n_distinct(caseid)) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_10) %>%
  summarise(n = n_distinct(caseid)) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_20) %>%
  summarise(n = n_distinct(caseid)) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_15) %>%
  summarise(n = n_distinct(caseid)) %>%
  mutate(proportion = n/sum(n))
```

## Exposure by demographic segments

### Age in 5 year groups

1 15-19
2 20-24
3 25-29
4 30-34
5 35-39
6 40-44
7 45-49

```{r}
zimbabwe %>%
  group_by(exposed_reg, v013) %>% #age in 5 year groups
  summarise(n = n_distinct(caseid)) %>%
  group_by(v013) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_10, v013) %>% #age in 5 year groups
  summarise(n = n_distinct(caseid)) %>%
  group_by(v013) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_20, v013) %>% #age in 5 year groups
  summarise(n = n_distinct(caseid)) %>%
  group_by(v013) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_15, v013) %>% #age in 5 year groups
  summarise(n = n_distinct(caseid)) %>%
  group_by(v013) %>%
  mutate(proportion = n/sum(n))
```


### Type of place of residence

1 Urban
2 Rural

```{r}
zimbabwe %>%
  group_by(exposed_reg, v025) %>% # type of place of residence
  summarise(n = n_distinct(caseid)) %>%
  group_by(v025) %>%
  mutate(proportion = n/sum(n))
```


```{r}
zimbabwe %>%
  group_by(exposed_10, v025) %>% # type of place of residence
  summarise(n = n_distinct(caseid)) %>%
  group_by(v025) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_20, v025) %>% # type of place of residence
  summarise(n = n_distinct(caseid)) %>%
  group_by(v025) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_15, v025) %>% # type of place of residence
  summarise(n = n_distinct(caseid)) %>%
  group_by(v025) %>%
  mutate(proportion = n/sum(n))
```


### Educational Attainment 

0 No education
1 Incomplete primary
2 Complete primary
3 Incomplete secondary
4 Complete secondary
5 Higher
9 Missing

```{r}
zimbabwe %>%
  group_by(exposed_reg, v149) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v149) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_10, v149) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v149) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_20, v149) %>%
  summarise(n = n_distinct(caseid)) %>%
  group_by(v149) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_15, v149) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v149) %>%
  mutate(proportion = n/sum(n))
```


### Wealth Index

1 Poorest
2 Poorer
3 Middle
4 Richer
5 Richest


```{r}
zimbabwe %>%
  group_by(exposed_reg, v190) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v190) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_10, v190) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v190) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_20, v190) %>%
  summarise(n = n_distinct(caseid)) %>%
  group_by(v190) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_15, v190) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v190) %>%
  mutate(proportion = n/sum(n))
```

Notes:
- could collapse categories into larger groups for 10 and 20
- may need to control for urban/rural during inference and modeling 


Next steps:
- figure out what each level represents (age, wealth index, urban/rural, education)
- descriptive stats for mali and nigeria 
- decide on exposure level 
  - too much overlap with 50
  - 10 or 20
  - could create exposure_15 variable 
- timing analysis
  - indicate before, during, after instead of exposure variable
- download foreign aid data and create an intensity score variable
  - https://www.aiddata.org/data/nigeria-aims-geocoded-research-release-level-1-v1-3-1


# Timing Analysis

```{r}
zimbabwe %>%
  filter(year == 2006) %>%
  group_by(time) %>%
  summarise(n = n_distinct(caseid))
```


```{r}
zimbabwe %>%
  group_by(time) %>%#v024 is region, v001 is cluster
  summarise(n = n_distinct(caseid))
```

## Sample size (number of women) by region and cluster

```{r}
zimbabwe %>%
  group_by(v024, time) %>%#v024 is region, v001 is cluster
  summarise(n = n_distinct(caseid))
```

## Proportion of exposed respondents

```{r}
zimbabwe %>%
  group_by(exposed_reg, time) %>%
  summarise(n = n_distinct(caseid)) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_10, time) %>%
  summarise(n = n_distinct(caseid)) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_20, time) %>%
  summarise(n = n_distinct(caseid)) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_15, time) %>%
  summarise(n = n_distinct(caseid)) %>%
  mutate(proportion = n/sum(n))
```

## Exposure by demographic segments

### Age in 5 year groups

1 15-19
2 20-24
3 25-29
4 30-34
5 35-39
6 40-44
7 45-49

```{r}
zimbabwe %>%
  group_by(exposed_reg, v013, time) %>% #age in 5 year groups
  summarise(n = n_distinct(caseid)) %>%
  group_by(v013) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_10, v013, time) %>% #age in 5 year groups
  summarise(n = n_distinct(caseid)) %>%
  group_by(v013) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_20, v013, time) %>% #age in 5 year groups
  summarise(n = n_distinct(caseid)) %>%
  group_by(v013) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_15, v013, time) %>% #age in 5 year groups
  summarise(n = n_distinct(caseid)) %>%
  group_by(v013) %>%
  mutate(proportion = n/sum(n))
```

### Type of place of residence

1 Urban
2 Rural

```{r}
zimbabwe %>%
  group_by(exposed_reg, v025, time) %>% # type of place of residence
  summarise(n = n_distinct(caseid)) %>%
  group_by(v025) %>%
  mutate(proportion = n/sum(n))
```


```{r}
zimbabwe %>%
  group_by(exposed_10, v025, time) %>% # type of place of residence
  summarise(n = n_distinct(caseid)) %>%
  group_by(v025) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_20, v025, time) %>% # type of place of residence
  summarise(n = n_distinct(caseid)) %>%
  group_by(v025) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_15, v025, time) %>% # type of place of residence
  summarise(n = n_distinct(caseid)) %>%
  group_by(v025) %>%
  mutate(proportion = n/sum(n))
```


### Educational Attainment 

0 No education
1 Incomplete primary
2 Complete primary
3 Incomplete secondary
4 Complete secondary
5 Higher
9 Missing

```{r}
zimbabwe %>%
  group_by(exposed_reg, v149, time) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v149) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_10, v149, time) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v149) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_20, v149, time) %>%
  summarise(n = n_distinct(caseid)) %>%
  group_by(v149) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_15, v149, time) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v149) %>%
  mutate(proportion = n/sum(n))
```


### Wealth Index

1 Poorest
2 Poorer
3 Middle
4 Richer
5 Richest


```{r}
zimbabwe %>%
  group_by(exposed_reg, v190, time) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v190) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_10, v190, time) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v190) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_20, v190, time) %>%
  summarise(n = n_distinct(caseid)) %>%
  group_by(v190) %>%
  mutate(proportion = n/sum(n))
```

```{r}
zimbabwe %>%
  group_by(exposed_15, v190, time) %>% 
  summarise(n = n_distinct(caseid)) %>%
  group_by(v190) %>%
  mutate(proportion = n/sum(n))
```


# Mali

```{r}
m1 <- readRDS("DHS_data/Mali/MLIR41FL_joined.RDS")
m2 <- readRDS("DHS_data/Mali/MLIR53FL_joined.RDS")
m3 <- readRDS("DHS_data/Mali/MLIR6AFL_joined.RDS")
m4 <- readRDS("DHS_data/Mali/MLIR7AFL_joined.RDS")
```

```{r}
mali <- rbind(m1, m2, m3, m4)
```

# Nigeria

```{r}
n1 <- readRDS("DHS_data/Nigeria/NGIR53FL_joined.RDS")
n2 <- readRDS("DHS_data/Nigeria/NGIR6AFL_joined.RDS")
n3 <- readRDS("DHS_data/Nigeria/NGIR7BFL_joined.RDS")
```

```{r}
nigeria <- rbind(n1, n2, n3)
```